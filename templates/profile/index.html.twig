{% extends 'base.html.twig' %}

{% block title %}Hello ProfileController!
{% endblock %}

{% block body %}
	<section class="profile-header">
		<div class="container">
			<h1>Mon Profil</h1>

			<div class="profile-card">
				<div class="avatar-wrapper">
					{% if app.user and app.user.imageName %}
						<img src="{{ vich_uploader_asset(app.user, 'imageFile') }}" alt="Avatar" class="avatar">
					{% else %}
						<img src="{{ asset('images/default.png') }}" alt="Avatar par défaut" class="avatar">
					{% endif %}
				</div>

				<div class="profile-info">
					<h2>{{ app.user.username }}</h2>
					<p class="favorites-count">
						<strong>{{ favorites|length }}</strong>
						beatmaps en favoris
					</p>
					<a href="{{ path('app_edit') }}" class="btn btn-edit">Modifier le profil</a>
				</div>
			</div>
		</div>
	</section>

	<section class="favorites-section">
		<div class="container">
			<h2>Mes Beatmaps Favoris</h2>

			{% if favorites is empty %}
				<div class="empty-state">
					<p>Vous n'avez pas encore ajouté de beatmap en favori.</p>
					<a href="{{ path('beatmap_search') }}" class="btn btn-primary">Rechercher des beatmaps</a>
				</div>
			{% else %}
				<div class="favorites-grid">
					{% for fav in favorites %}
						<div class="beatmap-card">
							<div class="card-cover">
								<img src="{{ fav.coverUrl }}" alt="{{ fav.title }} cover" loading="lazy">
							</div>
							<div class="card-content">
								<h3>{{ fav.artist }}
									-
									{{ fav.title }}</h3>
								<div class="card-actions">
									<a href="https://osu.ppy.sh/beatmapsets/{{ fav.beatmapsetId }}/download" target="_blank" class="btn btn-download">Télécharger</a>

									{% if app.user and fav.user and app.user.id == fav.user.id %}
										<a href="{{ path('app_delete_favorite', {'id': fav.id}) }}" class="btn btn-delete" onclick="return confirm('Vraiment supprimer cette beatmap des favoris ?');">
											Supprimer
										</a>
									{% endif %}
								</div>
							</div>
						</div>
					{% endfor %}
				</div>
			{% endif %}
		</div>
	</section>


{% endblock %}

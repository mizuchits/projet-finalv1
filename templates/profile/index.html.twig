{% extends 'base.html.twig' %}

{% block title %}Hello ProfileController!
{% endblock %}

{% block body %}
	<section class="profile-header">
    <div class="container">
        {% if isOwnProfile %}
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div class="alert alert-{{ label == 'error' ? 'danger' : label }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endfor %}
        {% endif %}

        <h1>Profil de {{ targetUser.username }}</h1>

        <div class="profile-card">
            <div class="avatar-wrapper">
                {% if targetUser.imageName %}
                    <img src="{{ vich_uploader_asset(targetUser, 'imageFile') }}" alt="Avatar de {{ targetUser.username }}" class="avatar">
                {% else %}
                    <img src="{{ asset('images/default.png') }}" alt="Avatar par défaut" class="avatar">
                {% endif %}
            </div>

            <div class="profile-info">
                <h2>{{ targetUser.username }}</h2>

                <p class="favorites-count">
                    <strong>{{ favorites|length }}</strong> beatmaps en favoris
                </p>

                {% if targetUser.description is not empty %}
                    <h3>Description</h3>
                    <p>{{ targetUser.description }}</p>
                {% endif %}

                {% if isOwnProfile %}
                    <a href="{{ path('app_edit') }}" class="btn btn-edit">Modifier mon profil</a>
                {% endif %}
            </div>
        </div>
    </div>
</section>

	<section class="favorites-section">
		<div class="container">
			<h2>Mes Beatmaps Favoris</h2>

			{% if favorites is empty %}
				<div class="empty-state">
					<p>Vous n'avez pas encore ajouté de beatmap en favori.</p>
					<a href="{{ path('beatmap_search') }}" class="btn btn-primary">Rechercher des beatmaps</a>
				</div>
			{% else %}
				<div class="favorites-grid">
					{% for fav in favorites %}
						<div class="beatmap-card">
							<div class="card-cover">
								<img src="{{ fav.coverUrl }}" alt="{{ fav.title }} cover" loading="lazy">
							</div>
							<div class="card-content">
								<h3>{{ fav.artist }}
									-
									{{ fav.title }}</h3>
								<p>{{ fav.description }}</p>
								<div class="card-actions">
									<a href="https://osu.ppy.sh/beatmapsets/{{ fav.beatmapsetId }}/download" target="_blank" class="btn btn-download">Télécharger</a>

									{% if app.user and fav.user and app.user.id == fav.user.id %}
										<a href="{{ path('app_delete_favorite', {'id': fav.id}) }}" class="btn btn-delete" onclick="return confirm('Vraiment supprimer cette beatmap des favoris ?');">
											Supprimer
										</a>
										<a href="{{ path('app_edit_beatmap', {'id': fav.id}) }}" class="btn">Éditer</a>
									{% endif %}
								</div>
							</div>
						</div>
					{% endfor %}
				</div>
			{% endif %}
		</div>
	</section>


{% endblock %}
